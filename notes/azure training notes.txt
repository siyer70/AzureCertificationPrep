www.azure.com
https://azure.microsoft.com/en-us/services/


notes
case study based questions - 10-15 questions per each case study
use the context of case study while answering the questions.

Fabric Controller

Storage Account
Container 

https://docs.microsoft.com/en-us/azure/storage/common/storage-create-storage-account
https://docs.microsoft.com/en-us/azure/storage/queues/storage-dotnet-how-to-use-queues
https://github.com/Azure/azure-webjobs-sdk/wiki/Queues#trigger

Storage
-------
500 IOPS
7500 IOPS


Resiliency 

Replication (this is not for high availability and backup)
LRS - 3 copies (p, s, t) - synchronous copy - in the same center
GRS - 3 copies - in one data center - 3 copies in different data center - asynchronous in other data center
ZRS - 3 copies - one region / zone - 3 copies in another region/zone - asynchronous in other region
RA GRS - 


tinyurl.com/yc2pkbt4

Only x64 architectures are suppored (32 bit applications are compatible though)

Windows Server 2008 SP2 and above can be migrated to Azure



Azure Portal 								Service Management API -> Azure Fabric Controller -> Azure Hypervisor
Powershell									
CLI
SDK for each service

											Authentication & Authorization on each layer


Capacity on Demand

Charges on Per minute

Storage - Per GB per month

Network is free except for Egress

Ingress - data that is coming into Azure - Free
Egress - data that is going out of Azure - Charegable


Focus - How can I optimize the cost?

Basic
	POC

Standard
	Dev/Test
	
	DS1_V2
	D Series
	S- SSD (Premium Storage)
	V2 - Generation Software

Traffic Manager Modes
---------------------
Performance (will route it to the nearest region)
Fault Tolerance (will route it to the closest active region)
Priority (will route based on the priority set)
FT + Priority

Availability set (Fault Domain + Update Domain) without Managed Disk Storage does not make much sense
(it could cover the vms but storage in itself could be single point of failure)


standard images - vndepot.msopentech.com


PS Template
parameters, variables, resources, outputs


Terraform - Infrastructure deployment (Automation)
(questions may come in exam)

terraform init
tarraform plan
terraform apply

(similar json templates in Azure)

Storage
VHD -  (Page Blob)
C:\ - 127GB in size
D:\ - 20 GB
F:\ - 1 TB or 4 TB

Premium Storage (DS OR GS)

Blob Cache
RAM Cache
SSD Cache

Limits - https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits

Unmanaged disks
200 storage accounts

Managed disks
10,000 disks per region

encryption - data loss
keyvault - password

StorSimple
(Hot, Warm, Cold)
https://www.petri.com/what-is-microsoft-storsimple


Machine Series
https://azure.microsoft.com/en-in/pricing/details/virtual-machines/windows/



70-532 exams

70 exams approx
2 hours
2 mins for each question

focus & eliminate 
do not read through case study
answer without reading the case study (majority will be covered)
for the remaining go through the case study
keep that day free

Yammer study groups

VM Scale Set
Scale by target CPU
Scale by schedule
Scale by queue message count


host - Azure Monitor, OMS
os - Azure Monitor, OMS, Standard windows events
application - Application Insight (Application Performance Management)

OMS
Log Analytics
Automation
Site Recovery

Cannot use PaaS in these cases
- Desktop Application
- Monolithic Application

Operational Management Suite
https://experience.mms.microsoft.com/



jdbc:sqlserver://shekharsqlserver.database.windows.net:1433;database=ShekharSQLDB;user=srinivca@shekharsqlserver;password={your_password_here};encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;


elastic pool
dbs will share the dtus instead of defining dtus at per db level

Multiple APP Service plans can be put in resource group
and multiple web apps can share the same App servie plan

Scaling rules are configured to a schedule
Performance scaling can be configured using various metrics
CPU
Memory
HTTP Queue
Disk Queue
Data In
Data Out

Function Apps
Webhooks

not source controlled


bijoys@technofocus.in

Unmanaged disks
- need to create storage account

Managed disks
- no need to create storage account
- specify the type (standard/premium) and size of the disk

Managed disks benefits over Unmanaged disks
- Storage unit isolation ensuring high availability
	- in case of unmanged disk - if you create 3 vms using separate storage accounts in an availability set 
	  under the hood it is using the same storage unit
	- in case of manged disk - if you create 3 vms using separate storage accounts in an availability set 
	  under the hood azure ensures that they are stored in distinct storage unit resulting in high availability

- while creating custom images, managed disks captures the vm and internally copies all the vhds in the image
  enabling easier creation of vms from the images without any hastles where as unmanged disks you would need to 
  copy the vhds in the storage account yourself and create multiple copies of it depending on the number of vms to create

- independent snapshots of single managed disk can be created - that can be used for the following:
	- parent disks can be deleted after taking the snapshot and can be recreated back from the snapshot - the snapshot
	  survives even after the parent disks are deleted
	- the snapshot can be copied to a RA-GRS storage account (automatically replicated in multiple regions)
	- point in time restoration can also be accomplished by using the snapshot to create managed disks
	- the snapshot can be used to create images which in turn can create new instances of vm

- upgrading from standard to premium or downgrading from premium to standard storage is easy in case of managed disks

https://docs.microsoft.com/en-us/azure/virtual-machines/windows/managed-disks-overview

https://docs.microsoft.com/en-us/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs


Examples to tried out
---------------------
01. Creating SQL DB (using PaaS)
02. Creating cosmos db
03. Storage queue & Service Bus
04. Storage Table
05. Service Fabric
06. Azure Container Service
07. Azure Search - Create a service index; add data; search an index; handle search results
08. Design Azure App Service Web Apps

Azure SDK
---------
- High level understanding

Create and Manage ARM VMs (20-25%)
=========================
Deploy Workloads on ARM VMs
01. Identify workloads that can and cannot be deployed
Perform configuration Management
02. Auotmate configuration management using Powershell DSC
03. VM Agent (custom script extensions) - Understand when to use
04. enable remote debugging
Scale ARM VMs
05. deploy ARM VM Scalesets & configure ARM VMSS auto scale
Design and implement ARM VM Storage
06. Configure disk caching
07. Plan for storage capacity
08. configure shared storage (read)
09. implement Azure Disk Encryption (Windows and Linux VMs)
Monitor ARM VMs
10. VM Monitoring, configure alerts, configure diagnostic and monitoring storage location
Manage ARM VM availability
11. Configuring each application tier into separate availability sets
12. Combine the Load Balancer with availability sets


Design and implement a Storage and Data Strategy (25-30%)
================================================
Implement Azure Storage blobs and Azure Files
01. Set metadata on a container
02. Stream data using blobs
03. Access blob securely
04. Implement async blob copy
05. Configure CDN
06. Design blob hierarchies
07. Configure custom domains (Read - how to configure custom domain)
08. Scale blob storage
09. Shard large datasets
10. Implement blob leasing
11. Implement Azure storage tables queues

Implement Azure storage tables, queues, and Azure Cosmos DB Table API
12. Implement CRUD with and without transactions
13. Query using oData
14. Scale tables and partitions
15. Add and process queue messages; Retrieve a batch of messages
16. Scale queues
17. Choose between Azure storage tables and Azure Cosmos DB Table API

Manage access and monitor storage
18. Generate Shared access signatures - including client renewal and data validation
19. Create stored access policies
20. Regenerate storage account keys
21. Configure and use CORS
22. Set retention policies and logging levels; Analyze logs

Implement Azure SQL Databases
23. Choosing the database performance level
24. Configure and perform point in time recovery
25. Enable geo-replication
26. Import and Export data and schema
27. Scale Azure SQL Databases (Read)
28. Manage Limits and resource governor
29. Implement SQL Data Sync
30. Implement graph database functionality in Azure SQL

Implement Azure Cosmos DB
31. Create Cosmo DB API databases and collections
32. Query documents
33. Run Cosmos DB Queries
34. Create Graph API Databases
35. Execute GraphDB queries
36. Implement MongoDB Database
37. Manage scaling of Cosmos DB, Consistency and RU/m
38. Manage multiple regions
39. Implement Stored Procedures
40. Access Cosmos DB from REST interface
41. Manage Cosmos DB Security

Implement Redis Caching
42. Choose a cache tier
43. Implement data persistence
44. Implement security and network isolation
45. Integrate Redis caching with ASP.NET session and cache providers

Implement Azure Search
46. Create a service index; add data; search an index; handle search results


Manage Identity, Application and Network Services (10-15%)
=================================================
Integrate an App with Azure Active Directory (AAD)
01. Develop apps that use WS-Federation, OAuth, and SAML-P endpoints 
02. Query the directory by using Microsoft Graph API, MFA and MFA API

Design and Implement a messaging strategy
03. Develop and scale messaging solutions using service bus queues, topics, relays, event hubs and notification hubs
04. Monitor Service bus queues, topics, relays, event hubs and notification hubs
05. When to use Event Hubs, Service Bus, IoT Hub, Stream Analytics and Notification Hubs (Read)

Design apps that use AAD B2C and AAD B2B
06. Design and implement .NET MVC, Web API and Windows Desktop apps that leverage social identity provider authentication
    including Microsoft Account, Facebook, Google+, Amazon and LinkedIn
07. Enforce Multi-factor Authentication

Manage secrets using Azure Key Vault
08. Configure Azure Key Vault
09. Manage Access including tenants (Read)
10. Implement HSM protected keys 
11. Manage service limits
12. Implement logging
13. Implement key rotation

Design and Implement Azure Compute, Web and Mobile Services (35-40%)
===========================================================
Design Azure App Service Web Apps
01. Certificates and custom domains
02. Implement diagnostics, monitoring and analytics
03. Design and Configure Web Apps for scale and resilience

Implement Azure Functions and WebJobs
04. Create Azure Functions
05. Implement a webhook function
06. Implement event processing function
07. Implement Azure-connected function
08. Design and implement custom binding
09. Debug a Function
10. Integrate a function with storage
11. Implement and configure proxies

Implement API Management
12. Create managed APIs
13. Configure API Management policies
14. Protect APIs with rate limits
15. Add caching to improve performance
16. Monitor APIs

Design Azure App Service API Apps
17. Create and Deploy API Apps
18. Automate API discovery by using the Swashbuckle
19. use Swagger API metadata to generate client code for an API app;
20. Monitor API Apps

Develop Azure App Service Logic Apps
21. Create a Logic App connecting SaaS services;
22. Create a Logic App with B2B capabilities
23. Create a Logic App with XML capabilities
24. Trigger a Logic App from another App
25. Create custom and long running actions
26. Monitor Logic Apps

Develop Azure App Service Mobile Apps
27. Create a Mobile App
28. Add offline sync to a Mobile App
29. Add authentication to a Mobile App
30. Add push notifications to a Mobile App

Develop and implement Azure Service Fabric Apps
31. Create a Service Fabric Application
32. Build an Actor-based service
33. Add a web front-end to a Service Fabric application
34. Monitor and Diagnose services
35. Create, secure, upgrade and scale Service Fabric Cluster in Azure
36. Scale a service fabric app
37. Deploy an Application to a Container

Design and implement Third Party Platform as a Service (PaaS)
38. Implement Cloud Foundry
39. Implement OpenShift
40. Provision applications by using Azure Quickstart Templates 
41. Build applications that leverage Azure Marketplace solutions and services

Design and implement DevOps
42. Instrument an application with telemetry 
43. Discover application performance issues by using Application Insights
44. Deploy Visual Studio Team Services with Continuous Integration (CI) and Continuous Deployment (CD)
45. Deploy CI/CD with third party platform tools (Jenkins, GitHub, Chef, Puppet, TeamCity)
46. Implement mobile DevOps by using HockeyApp



Web Apps for Containers (Docker Container / Azure container registry / Private Registry)

Azure container service (DC/OS - Kubernetes - Docker Swarm) - just allows the cluster
								how you package & deploy is not managed

Azure Container Service (Managed) (Kubernetes) - simplifies the deployment (need to be confirmed)

Service Fabric Clusters (Windows based os)


https://github.com/MicrosoftLearning/20532-DevelopingMicrosoftAzureSolutions



Storage queue vs Service Bus
Storage queue - push or pop kind of operation
Service Bus - (Managed Service - supports queues topics (pub/sub)



General purpose storage
Disks, Table, queues, files





Blob
for storing blobs

Multiple Access policies can be defined for table storage
These policies are then assigned at the application level to the respective users

Azure Tables - drawbacks
Geographical redundancy

Service Bus
Supports namespaces - Different application can connect to different namespaces
massively scalable and high throughput 
queue - any one subscriber reads the message, it is removed from the queue



Differences
https://www.c-sharpcorner.com/UploadFile/fe6121/deep-dive-into-azure-storage-queue-vs-azure-service-bus-queu/
https://msdn.microsoft.com/en-us/library/dn589781.aspx

Relays - Bi-Directional
Notification - Broadcasting

Web Apps
Storages
Service Bus

SQL DB - PaaS (Sql Server, MySQL, Postgres)



IaM - Idenity and Access Management

Roles
=====
Owner
Contributor
Reader

Supported Protocols
SAML 2.0
WS-Federation 
OpenID Connect
OAuth 2.0

Employees / internal - AAD is the better option
B2B - Two Active directories will communicate via WS - Federation (trust is established) - charged per user
B2C - Consumer centric - Oauth2.0 is the better option - charged per million of authentication per month

Multi-factor authentication (OTP, Verification Email, calls)
AAD supports following MFA - Calls, Emails, Authenticator App

AD -> AAD sync (specific users, what information needs to be sync) - AD Connect tool can be used for sync

Password write back from AD -> AAD
Password write back form AAD (Premium version only) -> AD

But users needs to be added first in AD (on-premise)

Supports AD Graph API

Domain Controller - manages the domains (Domain is group of connected servers)

When you install AAD, you can use Domain Controller role or Directory service role

Hardware Security Module (HSM)

storage queue vs service bus queue
https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted


Event Hubs, Event Grids, IoT hubs
https://azure.microsoft.com/en-in/blog/events-data-points-and-messages-choosing-the-right-azure-messaging-service-for-your-data/

https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-compare-event-hubs

https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/iot-hub/iot-hub-event-grid-routing-comparison.md

https://www.servicebus360.com/blogs/azure-service-bus-event-hub-event-grid-one-choose/


https://github.com/sonusathyadas/Azure-70-532-dumps


https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-sas


webapp getting started
https://docs.microsoft.com/en-us/azure/app-service/app-service-web-get-started-dotnet

creating and deploying webapp using sqlserverdb in a linux container using CLI
https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-dotnetcore-sqldb


azure key vault
Microsoft.KeyVault/vaults/deploy/action
https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-keyvault-parameter
https://docs.microsoft.com/en-us/powershell/module/azurerm.keyvault/set-azurermkeyvaultaccesspolicy?view=azurermps-5.2.0
https://docs.microsoft.com/en-us/powershell/module/azurerm.keyvault/?view=azurermps-5.2.0#key_vault
https://docs.microsoft.com/en-us/azure/key-vault/key-vault-secure-your-key-vault

search capacity planning
https://docs.microsoft.com/en-us/azure/search/search-capacity-planning



client id: 662f1dc0-5b94-4f8a-bc36-f1fa114be786
client secret: zdzeGZ280{@*iuuWIMAZ28(


https://docs.microsoft.com/en-us/azure/security/azure-log-audit

Topics to read
Backup and disaster recovery
Monitoring, Diagnostics, Performance counters, Tracing, Remote Debugging, Log files 
	- VM
	- Storage account
	- Webapp (App Insight)

Refresh
Storage account access policy, permissions, SAS token, access keys


startup tasks

https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-startup-tasks
https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-role-config-xpath
https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-startup-tasks-common

Covers Application Insights, Azure Diagnostics, Performance counter
https://docs.microsoft.com/en-us/azure/cloud-services/diagnostics-performance-counters

Diagnostics
Enabling Diagnostics for Web Apps in Azure App Service
https://docs.microsoft.com/en-us/azure/app-service/web-sites-enable-diagnostic-log


Scalability targets
https://docs.microsoft.com/en-us/azure/storage/common/storage-performance-checklist#subheading16
answer to throttling issue - (503 i.e. server busy or 500 time out - use exponential back off solution (i.e. retry after 2, 4 10, 30 seconds)
https://docs.microsoft.com/en-us/azure/storage/common/storage-performance-checklist#subheading14

CDN
Staggering the workload are other options
copy blobs across storage accounts (direct copy from one storage account to another)
use azcopy
use Azure import/export service
use metadata (limitation of 8KB rule)
upload in parallel (for fast uploads - for single blob, upload its blocks in parallel, for multiple blobs, upload them in parallel)


storage security guide
https://docs.microsoft.com/en-us/azure/storage/common/storage-security-guide

shared access signature
https://docs.microsoft.com/en-us/azure/storage/common/storage-dotnet-shared-access-signature-part-1

cors support
https://docs.microsoft.com/en-us/azure/storage/common/storage-cors-support

client side encryption
https://docs.microsoft.com/en-us/azure/storage/common/storage-client-side-encryption

https://docs.microsoft.com/en-us/azure/virtual-machines/windows/about-disks-and-vhds


Load Balancer
https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-overview


Activity Logs - Monitoring Overview
https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-activity-logs


Vault Name                       : KeyVaultExplore
Resource Group Name              : KeyVaultRG
Location                         : South India
Resource ID                      : /subscriptions/xxx/resourceGroups/KeyVaultRG/provi
                                   ers/Microsoft.KeyVault/vaults/KeyVaultExplore
Vault URI                        : https://KeyVaultExplore.vault.azure.net
Tenant ID                        : xxx
SKU                              : Standard
Enabled For Deployment?          : False
Enabled For Template Deployment? : False
Enabled For Disk Encryption?     : False
Soft Delete Enabled?             :
Access Policies                  :
                                   Tenant ID                                  : xxx
                                   Object ID                                  : xxx
                                   Application ID                             :
                                   Display Name                               : Shekhar Shekhar
                                   (xxx)
                                   Permissions to Keys                        : get, create, delete, list, update,
                                   import, backup, restore, recover
                                   Permissions to Secrets                     : get, list, set, delete, backup,
                                   restore, recover
                                   Permissions to Certificates                : get, delete, list, create, import,
                                   update, deleteissuers, getissuers, listissuers, managecontacts, manageissuers,
                                   setissuers, recover
                                   Permissions to (Key Vault Managed) Storage : delete, deletesas, get, getsas, list,
                                   listsas, regeneratekey, set, setsas, update

								   

(Allows schema and data to be copied in a blank database)
BCP (Copies from csv and sql database)
MS SSIS (SQL Server Integration Services) 

SQL Database Migration Wizard - Migration from SQL Server to Azure SQL Database
Allows you
	- check compatibility issues
	- migrate schema and bulk copy of data
	-adjust batch sizes

SQL Database Import and Export service
	- export data from azure sql database to blob storage
	- import data from blob storage to azure sql database

Sql Server Import and Export Wizard (this apparenty uses MS SSIS - SSIS uses SSIS Package that can be scheduled to run - it can be updated by SSDT tool)
	- does not perfrom compatibility check
	- does not copy indexes and constraints

Sql Server Migration Assistant
	- used to migrate data from different sql databases (like mysql, oracle) to azure sql server / azure sql database

Logic App trigger types and actions (covers Split-on for processing an array)
https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-workflow-actions-triggers

covers foreach loop (parallel), foreach loop (sequential), do until loop (with use cases)
https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-control-flow-loops


grouping actions with scope - see this example
https://docs.microsoft.com/en-us/azure/logic-apps/logic-apps-exception-handling


Application Gateway introduction
https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-introduction

https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-general


Configuring custom domain name
A record
CNAME Record

https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-domain#a

Verification of domain ownership
migrating from old site to the new site
remap A or cname record
https://docs.microsoft.com/en-us/azure/app-service/app-service-custom-domain-name-migrate
https://docs.microsoft.com/en-us/azure/dns/dns-custom-domain#app-service-web-apps

configuring ssl certificates for your webapp
https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl

run from zip (new way to deploy Azure webapp and functions)
https://github.com/Azure/app-service-announcements/issues/84

scaling azure functions
https://anthonychu.ca/post/scaling-azure-functions-http/

vsts continuous deployment
http://jakeydocs.readthedocs.io/en/latest/publishing/vsts-continuous-deployment.html

https://docs.microsoft.com/en-us/vsts/build-release/index?view=vsts
https://docs.microsoft.com/en-us/vsts/build-release/apps/cd/azure/aspnet-core-to-azure-webapp?view=vsts&tabs=vsts


Deployment Slot settings

Settings that are swapped:
General settings - such as framework version, 32/64-bit, Web sockets
App settings (can be configured to stick to a slot)
Connection strings (can be configured to stick to a slot)
Handler mappings
Monitoring and diagnostic settings
WebJobs content


Settings that are not swapped:
Publishing endpoints
Custom Domain Names
SSL certificates and bindings
Scale settings
WebJobs schedulers


Two types of SSL Connections
SNI (Server Name Indication) SSL connection
IP Address SSL connection
https://azure.microsoft.com/en-us/pricing/details/app-service/


Storage Queues
https://docs.microsoft.com/en-us/azure/storage/queues/storage-dotnet-how-to-use-queues#programmatically-access-queue-storage

Storage scalability targets
https://docs.microsoft.com/en-us/azure/storage/common/storage-scalability-targets

https://crpietschmann.github.io/Azure-70-532-Practice-Test/?

Network Address classes
https://technet.microsoft.com/en-us/library/cc940018.aspx

Subnet mask cheat sheet
https://www.aelius.com/njh/subnet_sheet.html

sql database
Limits
https://docs.microsoft.com/en-us/azure/sql-database/sql-database-resource-limits

what is a dtu
https://docs.microsoft.com/en-us/azure/sql-database/sql-database-what-is-a-dtu


DSC Overview
https://docs.microsoft.com/en-us/azure/automation/automation-dsc-overview
https://docs.microsoft.com/en-us/azure/automation/automation-dsc-getting-started
https://docs.microsoft.com/en-us/azure/automation/automation-dsc-compile

VM Scale Sets
https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-placement-groups
supports upto 1000 vms (if single placement group is false and manage disks are used and market place images are used)
if use custom images, it is restricted to 300 vms
if single placement group is true or manage disk is not used, it is restricted to 100 vms


DevOps
	Reduce the cost (3 options)
		stop at end of the business day
		start at start of the business day
		limit number of vms per user
		predesignated vm size

		
Swasbuckle Metadata for all API methods (some options were)
	XML Comments
	IOperationFilter
	
Redis cluster

Service Bus

PCF
1. To check - Cloud shell to install cloud foundry CLI

Added database connection string in key vault
When an application error occurs, it displays the configuration details
Database credentials should not be displayed to end user - options were
a. custom domain and ssl
b. azure active directory app
c. in web.config add pfx
d. x.509 certification using makecert

(May be the point is to encrypt the connection string)

Service bus connection
NameSpaceManager and NameSpaceManagerSettings
can use different constructors
NameSpaceManger.createFromConnectionString
NameSpaceManager(sburi, tokenprovder)
NameSpaceManager(uri, namespacemanagersettings())

see this example for the above
http://www.cloudcasts.net/devguide/Default.aspx?id=12018

PeekLock (two staged) - service will only mark the message as consume when it sees the complete() call from application
ReceiveAndDelete (single staged) - service will immediately mark the message as consumed as it forwards the message to the application

EnablePartitioning (high throughput and availability)
PreFetch (receive)
client side batching (send, complete)
batch store (writing to persistent store)
express (caching )


https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-performance-improvements

Tokenprovider example (nothing but storage account credentials)
http://www.cloudcasts.net/devguide/Default.aspx?id=12018

api management
policies
(fill in the blanks)
<rate-limit-by-key 
calls="3" renewal-period="15" c
counter-key = "@(context.Subscription.Id)"
/>

To check - provisioning vms
- can visual studio team services release management be used 
- vmextension vmagent
https://docs.microsoft.com/en-us/azure/automation/automation-intro
https://docs.microsoft.com/en-us/azure/automation/automation-runbook-types
https://docs.microsoft.com/en-us/vsts/build-release/concepts/definitions/release/what-is-release-management?view=vsts

templates structure documentation
https://docs.microsoft.com/en-us/azure/templates/

(run book or arm templates seems to be the answer)

cosmos db
queries

azure search
multi-tenant azure search
A tenant would not like to share workload and data
B tenant would like to share workload but not data
which one should you use for each tenant
A - service per tenant
B - index per tenant

mixed model (active tenants are assigned dedicated search service where as smaller tenants will have 
shared service - index (data) is isolated for all tenants)

routine questions
always on (webjob not running)
storage api sequence (parse, createxxxclient, getxxxreference, createIfNotExists(), specific to resource)
throttling issue (server busy or timeout - retry (exponential backoff))
which storage service to use (SMB Files - Azure Files, Windows Event logs - Table service, Crash dumps - Blob Service)
Application Insight analytics (AIQL)
requests | where timestamp > ago(7d) | summarize avg(duration) by bin(timestamp, 30m)

Key topics that needs to be looked into some details
PCF
Service Fabric
Azure Container Service
Service Bus
Cosmos DB
Redis
azure search
API Management
SSL
SAML-P, WS FEDERATION, OAUTH
Graph API
Application insight analytics
Powershell, CLI, REST API
Event Grid

Automation account
Service Definition schema (webrole)

expected but not there
Slots
Custom Domain
Graph API

16, 20,  25, 27, 30
		
Last section questions:
Data at rest security 
https://docs.microsoft.com/en-us/azure/security/azure-security-encryption-atrest
	Storage - SSE

https://msdn.microsoft.com/en-us/library/azure/gg557553.aspx
https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-azure-monitor


Common CLI Commands
https://docs.microsoft.com/en-us/azure/virtual-machines/linux/cli-manage
https://docs.microsoft.com/en-us/azure/virtual-machines/azure-cli-arm-commands
https://docs.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest#az-group-list

Active Directory, ADFS, WS-FED, SAML		
https://blogs.technet.microsoft.com/askpfeplat/2014/11/02/adfs-deep-dive-comparing-ws-fed-saml-and-oauth/
https://blogs.technet.microsoft.com/askpfeplat/2014/11/23/adfs-deep-dive-planning-and-design-considerations/
http://www.idm-360.com/idm360/saml-vs-ws-federation-for-single-sign-on/
https://msdn.microsoft.com/en-us/library/windows/desktop/bb736227(v=vs.85).aspx


Redis cache
https://github.com/MicrosoftDocs/azure-docs/blob/master/articles/redis-cache/cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-cache


kubernate name resolution
for service and pods
https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/

Certificate import command to local certificate store
Import-PfxCertificate -Exportable -CertStoreLocation Cert:\CurrentUser\My `
        -FilePath .\az532keyvault4sf-az532servicefabric-20180402.pfx `
        -Password (ConvertTo-SecureString -String shekhar -AsPlainText -Force)
		
aiql
requests | top 10 by duration desc
requests 
 | summarize avg(duration) by bin(timestamp, 30s)
 |  render timechart
requests | sort by timestamp desc | take 10 (same as first but slower)
requests | where toint(resultCode) == 401
requests 
 | where timestamp > ago(1h)
 | summarize avg(duration) by bin(timestamp, 30s)
 | render timechart
    // Specific dates:
    requests
    | where timestamp > datetime(2016-11-19) and timestamp < datetime(2016-11-21)
    | top 5 by duration
// projection
  requests | top 10 by timestamp desc
             | project timestamp, name, resultCode
			 
// example to rename an existing field, specify an expression in the projection
 requests
    | top 10 by timestamp desc
    | project  
            name,
            response = resultCode,
            timestamp,
            ['time of day'] = floor(timestamp % 1d, 1s)
			
// just add additional columns to the existing ones using extend
 requests
    | top 10 by timestamp desc
    | extend timeOfDay = floor(timestamp % 1d, 1s)

// join tables
 requests
    | where toint(resultCode) >= 500
    | join (exceptions) on operation_Id
    | take 30
	
requests |
    summarize count_ = sum(itemCount) by name, bin(timestamp, 30s)

requests 
    |   summarize count_ = sum(itemCount) by name
    | sort by count_ desc 
    | render barchart 
	
requests 
    |   summarize count_ = sum(itemCount) by name
    | sort by count_ desc 
    | render piechart 
	

performanceCounters
| summarize count(), avg(value) by category, instance, counter 

exceptions | join (requests) on operation_Id 

browserTimings
| summarize sum(itemCount), avg(totalDuration), avg(processingDuration) 
    by operation_Name
	
availabilityResults
| where success == "1"
| summarize max(duration) / 1000 by location, bin(timestamp, 15s)

// ajax call made from the browsser
dependencies | where client_Type == "Browser"
    | take 10

// calls made from the server	
dependencies | where client_Type == "PC"
    | take 10

docker commands
docker --version
docker version
docker info
docker run hello-world
docker image ls
docker container ls --all



PCF creation steps
Steps
1. storage account prefix - pcfsa
2. ssh public key (use puttygen to generate - puttygen is part of putty installation - look at the putty folder in program files)
3. select a service principal json file (d:\azure\pcf\sp\azure-credentials.json) that covers subscr id, tenant id, app id (service-principal), authentication key
4. get the pivotal network token (refresh token) from pivotal edit profile page (also called UAA-API-TOKEN)
5. create or specify the resource group 
6. select the location (central india for your organization where quota has been increased)


Pivotal Network token
aae43a43388b4c58a5c26c97ab7e0a5a-r

PCF main links
https://docs.pivotal.io/pivotalcf/2-0/customizing/pcf_azure.html#create-service-principal
https://network.pivotal.io/docs/api#public/docs/api/v2/access_token.md
https://blogs.msdn.microsoft.com/girishp/2015/09/20/increasing-core-quota-limits-in-azure/
https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-create-service-principal-portal#get-application-id-and-authentication-key

deployment takes about 3-4 hours

RBAC - built-in roles
https://docs.microsoft.com/en-us/azure/active-directory/role-based-access-built-in-roles#classic-storage-account-contributor

innovativesol.co.in
52.172.219.121
Parked

pcf cli pre installed in azure cloud shell
https://docs.microsoft.com/en-us/azure/virtual-machines/linux/cloudfoundry-deploy-your-first-app


service bus
Enable partitioning while creating topic
https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-partitioning

puppet
https://www.example42.com/tutorials/PuppetTutorial/#slide-9

cosmos db sql api example
https://docs.microsoft.com/en-us/azure/cosmos-db/tutorial-develop-sql-api-dotnet

cosmos db mongodb api example
https://docs.microsoft.com/en-us/azure/cosmos-db/tutorial-develop-mongodb

stored proc
https://docs.microsoft.com/en-us/azure/cosmos-db/programming

querying tables and entities (covers odata queries)
https://docs.microsoft.com/en-us/rest/api/storageservices/querying-tables-and-entities

consistency levels
https://docs.microsoft.com/en-us/azure/cosmos-db/consistency-levels


DSC
VM script extensions
Search
Swagger
SQL DB

OMS

Swagger
XML comment tag examples
https://msdn.microsoft.com/en-us/library/h9df2kfb(v=vs.110).aspx

Open api specification (covers schemes i.e. BasicAuth, APIKey, OAuth2 etc, security definition object, security scopes, security requirements object etc)
https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md

IOperationFilter could then be used to check specific attributes in action to infer which scopes are required

https://swagger.io/docs/specification/authentication/

https://blogs.msdn.microsoft.com/isgupt/2017/09/04/swagger-authentication-against-azure-ad-b2c/

Revise

01. ARM Templates - done
02. VM Scalesets - done
04. Disk encryption (windows & linux) - done
06. Scale SQL DB - done
07. Import and export data from sql db, blobs - done
19. Powershell, CLI samples - done except cli
20. Metrics, Monitoring, diagnostics (VM, storage, webapps) - done except storage  

08. PCF
09. Service Fabric (stateless and statefull) - done
10. AKS - done
11. COSMOS DB (UDFS AND Triggers, geo replication) - done
13. SAML, WS-FEDERATION, OAUTH - done

12. AD Graph API - done
14. AD B2C - done
15. AD B2B - done
16. Keyvault
17. Continuous delivery
21. OMS
24. Mobile Apps

03. Disk caching
05. Load Balancer
22. Storage Monitoring
23. Logic Apps
26. AIQL - done
25. Puppet

Refresher
Storage Account (GetMessages and PeekMessage format, processing in batch)
	code for blob, queue, table, file - done
	Monitoring, dianostic
Web Jobs - done

How to use queue
https://docs.microsoft.com/en-us/azure/storage/queues/storage-dotnet-how-to-use-queues

How to use file share
https://robindotnet.wordpress.com/tag/azurefiles/

Disk Encryption
https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption
BitLocker for Windows
DS-Crypt for Linux
DEK - Data Encryption Key (stored in keyvault - symmetric key (same key is used for encryption and decryption)
KEK - Key Encryption Key (DEKs are themselves encrypted using asymmetric key)


https://docs.microsoft.com/en-us/azure/architecture/best-practices/naming-conventions


3 tests
measureup
533 test
534 test

using keyvault for storing password to be used in arm templates, powershell, cli scripts
https://blogs.technet.microsoft.com/paulomarques/2016/05/27/safeguarding-your-passwords-when-deploying-azure-virtual-machines-with-azure-powershell-module-and-arm-templates-by-using-azure-key-vault/

New-AzureRmKeyVault -VaultName "az533keyvault" -ResourceGroupName "az70533vm-rg" -Location "centralindia" -EnabledForTemplateDeployment

Vault Name                       : az533keyvault
Resource Group Name              : az70533vm-rg
Location                         : centralindia
Resource ID                      : /subscriptions/xxx/resourceGroups/az70533vm-rg/pr
                                   oviders/Microsoft.KeyVault/vaults/az533keyvault
Vault URI                        : https://az533keyvault.vault.azure.net
Tenant ID                        : xxx
SKU                              : Standard
Enabled For Deployment?          : False
Enabled For Template Deployment? : False
Enabled For Disk Encryption?     : False
Soft Delete Enabled?             : 
Access Policies                  : 
                                   Tenant ID                                  : xxxx
                                   Object ID                                  : xxxx
                                   Application ID                             : 
                                   Display Name                               : Shekhar Shekhar 
                                   (xxxx)
                                   Permissions to Keys                        : get, create, delete, list, update, 
                                   import, backup, restore, recover
                                   Permissions to Secrets                     : get, list, set, delete, backup, 
                                   restore, recover
                                   Permissions to Certificates                : get, delete, list, create, import, 
                                   update, deleteissuers, getissuers, listissuers, managecontacts, manageissuers, 
                                   setissuers, recover
                                   Permissions to (Key Vault Managed) Storage : delete, deletesas, get, getsas, 
                                   list, listsas, regeneratekey, set, setsas, update

Set-AzureKeyVaultSecret -VaultName "az533keyvault" -Name "AdminPassword" -SecretValue (Get-Credential).Password
(topsecret)
you can check what you have set as follows:
$password = Get-AzureKeyVaultSecret -VaultName "az533keyvault" -Name "AdminPassword"

Set-AzureRmKeyVaultAccessPolicy -VaultName 'az533keyvault' -EnabledForTemplateDeployment

Creating VMS
https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-manage-vm
https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-custom-images
https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-create-vmss
(also read the autoscale settings related info from here)
https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-understanding-autoscale-settings
https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-availability-sets
https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-load-balancer


Service fabric - partitioning 
https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-concepts-partitioning


COSMOS DB SQL Query
https://docs.microsoft.com/en-us/azure/cosmos-db/sql-api-sql-query

OpenShift
Kubernetes
Docker
https://www.slideshare.net/imesh/an-introduction-to-kubernetes
https://www.slideshare.net/SamuelTerburg/openshift-enterprise-31-vs-kubernetes?next_slideshow=1
https://www.slideshare.net/adityakonarde/introduction-to-docker-63666306

PCF
https://www.slideshare.net/SufyaanKazi/manchester-geek-night-pcf-101

Azure AD Graph API
https://msdn.microsoft.com/en-us/library/azure/ad/graph/api/functions-and-actions

Devops
https://docs.microsoft.com/en-us/azure/devtest-lab/devtest-lab-set-lab-policy

topics/items to revise
cors options preflight request status codes
api management (dev portal and )
number of blobs in a storage account and in container
how errors are trapped in unattended executions in Powershell - what role does serviceprincipal has
static ip address allocation
b2b and b2c practicals - capabilities read (csv import function for mass import)
read about azure scheduler and cron job
automation dsc - where all it can be used in addition to azure environment (for ex: aws, on-premis vms etc) and also Windows Management Framework
azure hybrid connection and hybrid connection manager (relay agent)
logic app - esp securing the url to be called from third party 
App Service Env
languages supported
tiers and their broad features in common services
dsc
use windows disk configuration tool to remap d:\ drive to another letter and then reclaim the d drive for your use
Geo restore option in sql database and also see if there is anything called point in time restore option (in sql db or sql server)


API endpoint:   https://api.run.pivotal.io (API version: 2.107.0)
User:           siyer70@gmail.com
Org:            Explorer
Space:          development

cf-spring-brash-swan.cfapps.io

https://blogs.msdn.microsoft.com/sanket/2017/11/02/api-management-quota-versus-rate-limits/
